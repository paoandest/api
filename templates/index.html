<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GEO PROJECT - Proxy List</title>

  <!-- Fonts & CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <!-- Meta Tags -->
  <meta property="og:title" content="GEO PROJECT - Daftar Proxy Aman & Cepat" />
  <meta property="og:description" content="Akses berbagai proxy VLESS, Trojan, dan Shadowsocks dengan mudah dan cepat." />
  <meta property="og:image" content="https://raw.githubusercontent.com/jaka2m/mau/refs/heads/kepo/a.png" />
  <meta name="twitter:card" content="summary_large_image">

  <!-- Favicon -->
  <link rel="icon" href="https://raw.githubusercontent.com/jaka2m/mau/refs/heads/kepo/G.png" type="image/x-icon" />
</head>
<body>  
  <div class="container">
    <nav class="navbar">
      <a href="/" class="logo">GEO PROJECT</a>
      <div class="nav-links">
        <a href="/" class="active">Home</a>
        <a href="/checker">Checker</a>
        <a href="/sub">Sub Link</a>
      </div>
    </nav>

    <div class="card">
        <h2>Proxy List</h2>
        <div class="status-box">
          <div class="status-item">
            <div>Total</div>
            <h3 id="total">0</h3>
          </div>
          <div class="status-item">
            <div>Active</div>
            <h3 id="active">0</h3>
          </div>
          <div class="status-item">
            <div>Dead</div>
            <h3 id="dead">0</h3>
          </div>
        </div>

        <div class="table-container">
          <table id="proxyTable" class="display" style="width:100%">
            <thead>
              <tr>
                <th>IP PORT</th>
                <th>STATUS</th>
                <th>COUNTRY</th>
                <th>ISP</th>
                <th>ACTION</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 FREE VPN CF</p>
  </footer>

    <!-- Modal Protokol -->
    <div id="protocolModal" class="modal">
      <div class="modal-content">
        <i class="fa-solid fa-xmark close" onclick="closeModal('protocolModal')"></i>
        <div class="modal-header">Pilih Protokol</div>
        <div class="config-buttons">
          <button onclick="selectProtocol('vless')">VLESS</button>
          <button onclick="selectProtocol('trojan')">TROJAN</button>
          <button onclick="selectProtocol('ss')">SHADOWSOCKS</button>
        </div>
      </div>
    </div>

    <!-- Modal Bug Selection -->
    <div id="bugModal" class="modal">
        <div class="modal-content">
            <i class="fa-solid fa-xmark close" onclick="closeModal('bugModal')"></i>
            <div class="modal-header">Pilih Bug Mode dan Bug Host</div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label><input type="radio" name="bugMode" value="normal" checked> Normal</label>
                <label style="margin-left: 20px;"><input type="radio" name="bugMode" value="wildcard"> Wildcard</label>
            </div>
            <div class="form-group">
                <select id="bugSelect" class="form-control">
                    <option value="business.blibli.com">business.blibli.com</option>
                    <option value="ava.game.naver.com">ava.game.naver.com</option>
                    <option value="graph.instagram.com">graph.instagram.com</option>
                    <option value="quiz.int.vidio.com">quiz.int.vidio.com</option>
                    <option value="live.iflix.com">live.iflix.com</option>
                    <option value="support.zoom.us">support.zoom.us</option>
                    <option value="blog.webex.com">blog.webex.com</option>
                    <option value="investors.spotify.com">investors.spotify.com</option>
                    <option value="cache.netflix.com">cache.netflix.com</option>
                    <option value="zaintest.vuclip.com">zaintest.vuclip.com</option>
                    <option value="ads.ruangguru.com">io.ruangguru.com</option>
                    <option value="api.midtrans.com">api.midtrans.com</option>
                    <option value="investor.fb.com">investor.fb.com</option>
                    <option value="bakrie.ac.id">bakrie.ac.id</option>
                </select>
            </div>
            <div style="text-align: right; margin-top: 15px;">
                <button onclick="confirmBugSelection()" class="btn" style="width: auto;">Pilih</button>
            </div>
        </div>
    </div>

    <!-- Modal TLS -->
    <div id="tlsModal" class="modal">
      <div class="modal-content">
        <i class="fa-solid fa-xmark close" onclick="closeModal('tlsModal')"></i>
        <div class="modal-header">Pilih TLS / Non-TLS</div>
        <div class="config-buttons">
          <button onclick="copyConfig('tls')">Copy TLS</button>
          <button onclick="copyConfig('nontls')">Copy NTLS</button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
 let total = 0, active = 0, dead = 0;
let currentConfigType = {};

async function checkStatus(ip, port, container) {
  const corsProxy = 'https://cors.checker-ip.web.id/?url=';
  const url = `${corsProxy}https://api.checker-ip.web.id/check?ip=${ip}:${port}`;

  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error('Network response not ok');
    const data = await response.json();
    const status = data.status === 'ACTIVE' ? 'active' : 'inactive';
    const icon = status === 'active' ? '<i class="fas fa-check-circle"></i>' : '<i class="fas fa-times-circle"></i>';
    const delay = data.delay || 0;

    container.innerHTML = `<div class="status ${status}">${icon}</div><span class="delay">(${delay})</span>`;

    if (status === 'active') active++;
    else dead++;
    updateStatusCount();
  } catch (error) {
    console.error('Error checking status:', error);
    container.innerHTML = `<div class="status error">&#10007; DEAD</div>`;
    dead++;
    updateStatusCount();
  }
}

function updateStatusCount() {
  $('#total').text(total);
  $('#active').text(active);
  $('#dead').text(dead);
}

async function loadProxies() {
  try {
    const url = 'https://raw.githubusercontent.com/jaka2m/botak/refs/heads/main/cek/proxyList.txt';
    const res = await fetch(url);
    if (!res.ok) throw new Error('Failed to fetch proxy list');
    const text = await res.text();
    const lines = text.trim().split('\n');

    const countryMap = {
      AF: "Afghanistan", AL: "Albania", DZ: "Algeria", AS: "American Samoa", AD: "Andorra",
      AO: "Angola", AI: "Anguilla", AQ: "Antarctica", AG: "Antigua and Barbuda", AR: "Argentina",
      AM: "Armenia", AW: "Aruba", AU: "Australia", AT: "Austria", AZ: "Azerbaijan",
      BS: "Bahamas", BH: "Bahrain", BD: "Bangladesh", BB: "Barbados", BY: "Belarus",
      BE: "Belgium", BZ: "Belize", BJ: "Benin", BM: "Bermuda", BT: "Bhutan",
      BO: "Bolivia", BA: "Bosnia and Herzegovina", BW: "Botswana", BR: "Brazil", BN: "Brunei",
      BG: "Bulgaria", BF: "Burkina Faso", BI: "Burundi", KH: "Cambodia", CM: "Cameroon",
      CA: "Canada", CV: "Cape Verde", KY: "Cayman Islands", CF: "Central African Republic", TD: "Chad",
      CL: "Chile", CN: "China", CO: "Colombia", KM: "Comoros", CG: "Congo (Brazzaville)",
      CD: "Congo (Kinshasa)", CR: "Costa Rica", HR: "Croatia", CU: "Cuba", CY: "Cyprus",
      CZ: "Czech Republic", DK: "Denmark", DJ: "Djibouti", DM: "Dominica", DO: "Dominican Republic",
      EC: "Ecuador", EG: "Egypt", SV: "El Salvador", GQ: "Equatorial Guinea", ER: "Eritrea",
      EE: "Estonia", ET: "Ethiopia", FJ: "Fiji", FI: "Finland", FR: "France",
      GA: "Gabon", GM: "Gambia", GE: "Georgia", DE: "Germany", GH: "Ghana",
      GR: "Greece", GD: "Grenada", GT: "Guatemala", GN: "Guinea", GW: "Guinea-Bissau",
      GY: "Guyana", HT: "Haiti", HN: "Honduras", HK: "Hong Kong", HU: "Hungary",
      IS: "Iceland", IN: "India", ID: "Indonesia", IR: "Iran", IQ: "Iraq",
      IE: "Ireland", IL: "Israel", IT: "Italy", JM: "Jamaica", JP: "Japan",
      JO: "Jordan", KZ: "Kazakhstan", KE: "Kenya", KI: "Kiribati", KP: "North Korea",
      KR: "South Korea", KW: "Kuwait", KG: "Kyrgyzstan", LA: "Laos", LV: "Latvia",
      LB: "Lebanon", LS: "Lesotho", LR: "Liberia", LY: "Libya", LI: "Liechtenstein",
      LT: "Lithuania", LU: "Luxembourg", MO: "Macao", MK: "North Macedonia", MG: "Madagascar",
      MW: "Malawi", MY: "Malaysia", MV: "Maldives", ML: "Mali", MT: "Malta",
      MH: "Marshall Islands", MR: "Mauritania", MU: "Mauritius", MX: "Mexico", FM: "Micronesia",
      MD: "Moldova", MC: "Monaco", MN: "Mongolia", ME: "Montenegro", MA: "Morocco",
      MZ: "Mozambique", MM: "Myanmar", NA: "Namibia", NR: "Nauru", NP: "Nepal",
      NL: "Netherlands", NZ: "New Zealand", NI: "Nicaragua", NE: "Niger", NG: "Nigeria",
      NO: "Norway", OM: "Oman", PK: "Pakistan", PW: "Palau", PS: "Palestine",
      PA: "Panama", PG: "Papua New Guinea", PY: "Paraguay", PE: "Peru", PH: "Philippines",
      PL: "Poland", PT: "Portugal", QA: "Qatar", RO: "Romania", RU: "Russia",
      RW: "Rwanda", KN: "Saint Kitts and Nevis", LC: "Saint Lucia", VC: "Saint Vincent and the Grenadines", WS: "Samoa",
      SM: "San Marino", ST: "Sao Tome and Principe", SA: "Saudi Arabia", SN: "Senegal", RS: "Serbia",
      SC: "Seychelles", SL: "Sierra Leone", SG: "Singapore", SK: "Slovakia", SI: "Slovenia",
      SB: "Solomon Islands", SO: "Somalia", ZA: "South Africa", SS: "South Sudan", ES: "Spain",
      LK: "Sri Lanka", SD: "Sudan", SR: "Suriname", SE: "Sweden", CH: "Switzerland",
      SY: "Syria", TW: "Taiwan", TJ: "Tajikistan", TZ: "Tanzania", TH: "Thailand",
      TL: "Timor-Leste", TG: "Togo", TO: "Tonga", TT: "Trinidad and Tobago", TN: "Tunisia",
      TR: "Turkey", TM: "Turkmenistan", TV: "Tuvalu", UG: "Uganda", UA: "Ukraine",
      AE: "United Arab Emirates", GB: "United Kingdom", US: "United States", UY: "Uruguay", UZ: "Uzbekistan",
      VU: "Vanuatu", VE: "Venezuela", VN: "Vietnam", YE: "Yemen", ZM: "Zambia",
      ZW: "Zimbabwe"
    };

    total = lines.length;
    active = 0;
    dead = 0;
    window.proxyLines = lines;

    const rows = lines.map((line, index) => {
      const parts = line.split(',');
      if (parts.length < 4) return ['Invalid data', '-', '-', '-', '-'];

      const [ip, port, countryCode, isp] = parts;
      const code = countryCode?.trim().toUpperCase() || '-';
      const countryName = countryMap[code] || code;
      const flag = code && code !== '-' ? `<img src="https://flagcdn.com/w40/${code.toLowerCase()}.png" style="height:16px; margin-right:5px;">` : '';

      return [
        `${ip}:${port}`,
        `<div class="status-block" data-checked="false"><div class="spinner"></div></div>`,
        `${flag} ${countryName}`,
        isp || '-',
        `<button class="btn" style="width: auto; padding: 6px 12px;" data-index="${index}">Config</button>`
      ];
    });

    const table = $('#proxyTable').DataTable();
    table.clear();
    table.rows.add(rows);
    table.draw();

    updateStatusCount();
    if (typeof checkVisibleRows === 'function') {
      checkVisibleRows();
      table.off('draw').on('draw', checkVisibleRows);
    }
  } catch (error) {
    console.error('Failed to load proxies:', error);
    alert('Gagal memuat daftar proxy.');
  }
}

$('#proxyTable tbody').on('click', 'button.btn', function () {
  const index = $(this).data('index');
  if (typeof window.proxyLines === 'undefined' || !window.proxyLines[index]) return;
  const [ip, port, countryCode, isp] = window.proxyLines[index].split(',');
  openProtocolModal(ip, port, countryCode?.trim().toUpperCase() || '-', isp);
});

function openProtocolModal(ip, port, country, isp) {
  currentConfigType = { ip, port, country, isp };
  openModal('protocolModal');
}

function selectProtocol(protocol) {
  currentConfigType.protocol = protocol;
  closeModal('protocolModal');
  openModal('bugModal');
}

function confirmBugSelection() {
  const bugMode = document.querySelector('input[name="bugMode"]:checked');
  const bugSelect = document.getElementById('bugSelect');
  if (!bugMode || !bugSelect) return;
  currentConfigType.bugMode = bugMode.value;
  currentConfigType.selectedBug = bugSelect.value;
  closeModal('bugModal');
  openModal('tlsModal');
}

function copyConfig(tlsType) {
  const { ip, port, country, isp, protocol, bugMode = 'normal', selectedBug = '' } = currentConfigType;
  const uuid = 'f282b878-8711-45a1-8c69-5564172123c1';
  const baseDomain = 'joss.krikkrik.tech';
  const standardPort = tlsType === 'tls' ? 443 : 80;
  const path = `/Free-VPN-CF-Geo-Project/${ip}=${port}`;
  const tag = `${country} - ${isp}`.replace(/ /g, '%20');
  const tlsLabel = tlsType === 'tls' ? 'TLS' : 'NTLS';
  const tlsValue = tlsType === 'tls' ? 'tls' : 'none';
  let address = (bugMode === 'wildcard' && selectedBug) ? selectedBug : baseDomain;
  let host = (bugMode === 'wildcard' && selectedBug) ? `${selectedBug}.${baseDomain}` : baseDomain;
  let sni = host;
  let config = '';

  switch (protocol) {
    case 'vless':
      config = `vless://${uuid}@${address}:${standardPort}?encryption=none&security=${tlsValue}&type=ws&host=${encodeURIComponent(host)}&path=${encodeURIComponent(path)}&sni=${encodeURIComponent(sni)}#${tag}%20[VLESS-${tlsLabel}]`;
      break;
    case 'trojan':
      config = `trojan://${uuid}@${address}:${standardPort}?security=${tlsValue}&type=ws&host=${encodeURIComponent(host)}&path=${encodeURIComponent(path)}&sni=${encodeURIComponent(sni)}#${tag}%20[Trojan-${tlsLabel}]`;
      break;
    case 'ss':
      const ssBase64 = btoa(`none:${uuid}`);
      config = `ss://${ssBase64}@${address}:${standardPort}?encryption=none&type=ws&host=${encodeURIComponent(host)}&path=${encodeURIComponent(path)}&security=${tlsValue}&sni=${encodeURIComponent(sni)}#${tag}%20[SS-${tlsLabel}]`;
      break;
  }

  navigator.clipboard.writeText(config).then(() => {
    Swal.fire('Copied!', 'Config copied to clipboard.', 'success');
  });
  closeModal('tlsModal');
}

function checkVisibleRows() {
    const table = $('#proxyTable').DataTable();
    table.rows({ page: 'current' }).every(function () {
        const row = $(this.node());
        const ipPort = row.find('td').eq(0).text().split(':');
        const statusCell = row.find('.status-block');
        if (ipPort.length === 2 && !statusCell.data('checked')) {
            statusCell.html('<div class="spinner"></div>'); // You need to define spinner CSS
            checkStatus(ipPort[0], ipPort[1], statusCell[0]);
            statusCell.data('checked', true);
        }
    });
}

function openModal(id) { document.getElementById(id).classList.add('show'); }
function closeModal(id) { document.getElementById(id).classList.remove('show'); }

window.onclick = function (e) {
    ['protocolModal', 'bugModal', 'tlsModal'].forEach(id => {
        if (e.target === document.getElementById(id)) closeModal(id);
    });
}

$(document).ready(function () {
    $('#proxyTable').DataTable({
        "pageLength": 10,
        "lengthMenu": [10, 25, 50, 100],
        drawCallback: function () {
            checkVisibleRows();
        }
    });
    loadProxies();
});
</script>
</body>
</html>
